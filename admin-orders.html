<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orders Admin - byJ.</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-50">
    <div class="container mx-auto px-6 py-12">
        <h1 class="text-4xl font-bold mb-8">Orders Database</h1>
        
        <div class="mb-4">
            <button onclick="loadOrders()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg">
                <i class="fas fa-sync-alt mr-2"></i>Refresh Orders
            </button>
        </div>
        
        <div id="orders-container" class="bg-white rounded-lg shadow-lg overflow-hidden">
            <div class="p-8 text-center text-gray-500">
                <i class="fas fa-spinner fa-spin text-4xl mb-4"></i>
                <p>Loading orders...</p>
            </div>
        </div>
    </div>

    <script>
        async function loadOrders() {
            const container = document.getElementById('orders-container');
            container.innerHTML = '<div class="p-8 text-center text-gray-500"><i class="fas fa-spinner fa-spin text-4xl mb-4"></i><p>Loading orders...</p></div>';
            
            try {
                const response = await fetch('/api/orders');
                if (!response.ok) {
                    throw new Error('Failed to load orders');
                }
                
                const orders = await response.json();
                
                if (orders.length === 0) {
                    container.innerHTML = '<div class="p-8 text-center text-gray-500"><i class="fas fa-shopping-cart text-4xl mb-4"></i><p>No orders yet</p></div>';
                    return;
                }
                
                let html = `
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Customer</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Items</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Session ID</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                `;
                
                orders.forEach(order => {
                    const items = JSON.parse(order.items || '[]');
                    const itemsList = items.map(item => `${item.name} (x${item.quantity})`).join(', ');
                    const date = new Date(order.created_at).toLocaleString();
                    const amount = typeof order.amount_total === 'number' 
                        ? order.amount_total 
                        : parseFloat(order.amount_total);
                    
                    html += `
                        <tr class="hover:bg-gray-50">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">#${order.id}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${date}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${order.customer_email || 'N/A'}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-900">$${amount.toFixed(2)} ${order.currency.toUpperCase()}</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${
                                    order.payment_status === 'paid' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'
                                }">
                                    ${order.payment_status || 'pending'}
                                </span>
                            </td>
                            <td class="px-6 py-4 text-sm text-gray-500">${itemsList || 'N/A'}</td>
                            <td class="px-6 py-4 text-sm text-gray-500 font-mono text-xs">${order.stripe_session_id.substring(0, 20)}...</td>
                        </tr>
                    `;
                });
                
                html += `
                        </tbody>
                    </table>
                    <div class="bg-gray-50 px-6 py-4 border-t border-gray-200">
                        <p class="text-sm text-gray-600">Total Orders: <span class="font-semibold">${orders.length}</span></p>
                    </div>
                `;
                
                container.innerHTML = html;
            } catch (error) {
                container.innerHTML = `<div class="p-8 text-center text-red-500"><i class="fas fa-exclamation-triangle text-4xl mb-4"></i><p>Error loading orders: ${error.message}</p></div>`;
            }
        }
        
        // Load orders on page load
        loadOrders();
        
        // Auto-refresh every 30 seconds
        setInterval(loadOrders, 30000);
    </script>
</body>
</html>


