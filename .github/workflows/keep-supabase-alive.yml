name: Keep Supabase Active

on:
  schedule:
    # Run twice daily to ensure Supabase stays active (Supabase pauses after 7 days of inactivity)
    # Morning: 9:00 AM UTC
    - cron: '0 9 * * *'
    # Evening: 9:00 PM UTC (for extra safety)
    - cron: '0 21 * * *'
  workflow_dispatch:  # Allows manual triggering from GitHub UI

jobs:
  ping-supabase:
    runs-on: ubuntu-latest
    
    steps:
      - name: Ping health endpoint
        run: |
          # Use the actual Vercel URL or fallback to secret
          VERCEL_URL="${VERCEL_URL:-https://byj.vercel.app}"
          HEALTH_SECRET="${{ secrets.HEALTH_CHECK_SECRET }}"
          
          if [ -z "$HEALTH_SECRET" ]; then
            echo "‚ùå HEALTH_CHECK_SECRET secret is not set in GitHub"
            exit 1
          fi
          
          echo "üîç Pinging: $VERCEL_URL/api/health"
          response=$(curl -s -o /dev/null -w "%{http_code}" \
            -X GET "$VERCEL_URL/api/health" \
            -H "Authorization: Bearer $HEALTH_SECRET")
          
          echo "üìä Response status: $response"
          
          if [ $response -eq 200 ]; then
            echo "‚úÖ Supabase pinged successfully - database is active"
          else
            echo "‚ùå Failed with status: $response"
            echo "‚ö†Ô∏è  Check that HEALTH_CHECK_SECRET is set correctly in GitHub Secrets"
            exit 1
          fi
